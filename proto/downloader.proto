syntax = "proto3";

// import "google/protobuf/timestamp.proto";
// import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";

option go_package = ".;proto";

service DownloadService {
  // åˆå§‹åŒ–
  rpc Init(google.protobuf.Empty) returns (google.protobuf.Empty) {}
  // æ›´æ–°æ’ä»¶
  rpc Update(google.protobuf.Empty) returns (google.protobuf.Empty) {}
  // å…³é—­æ’ä»¶
  rpc Shutdown(google.protobuf.Empty) returns (google.protobuf.Empty) {}

  // è·å–ä¿¡æ¯
  rpc GetInfo(InfoRequest) returns (InfoResponse) {}
  // è§£æä¿¡æ¯
  rpc Parse(TasksRequest) returns (TasksResponse) {}

  // ä¸‹è½½
  rpc Download(TaskRequest) returns (stream Task) {}
  // æš‚åœ
  rpc Pause(TaskRequest) returns (TaskResponse) {}
  // æ¢å¤
  rpc Resume(TaskRequest) returns (TaskResponse) {}
  // åœæ­¢
  rpc Stop(TaskRequest) returns (TaskResponse) {}
}

// ---------------------------- è¯·æ±‚ ----------------------------

message InfoRequest {
  string url = 1; // ä¸‹è½½é“¾æ¥
}

message TasksRequest {
  repeated Task tasks = 1; // ä»»åŠ¡
}

message TaskRequest {
  string id = 1; // ä»»åŠ¡ID
  Task task = 2;
}

// ---------------------------- Responses ----------------------------

// ğŸŒ å®¿ä¸»æä¾›
// ğŸŒ™ æ’ä»¶æä¾›

// ä¸»ä»»åŠ¡ä¿¡æ¯
message InfoResponse {
  string title = 1;          // ç³»åˆ—æ ‡é¢˜
  string cover = 2;          // å°é¢
  string author = 3;         // ä½œè€…
  string downloader_dir = 4; // å·¥ä½œè·¯å¾„(ğŸŒ)
  bool need_parse = 5;       // æ˜¯å¦éœ€è¦è§£æ(ğŸŒ™)
  repeated Task tasks = 6;   // ä»»åŠ¡åˆ—è¡¨(ğŸŒ™)
}

message TasksResponse {
  repeated Task tasks = 2; // ä»»åŠ¡åˆ—è¡¨
}

message TaskResponse {
  string id = 1; // (ğŸŒ™)
  string state = 2;
}

// ---------------------------- Models ----------------------------

// ä»»åŠ¡
// ä»»åŠ¡å¯èƒ½åŒ…å«è§†é¢‘ç‰‡æ®µ, éŸ³é¢‘ç‰‡æ®µ, å›¾ç‰‡èµ„æºç­‰ç­‰
message Task {  
  string id = 1;                      // ID (ğŸŒ)
  string url = 2;                     // é“¾æ¥
  string session_id = 3;              // ä¼šè¯ID ğŸŒ™ ç”±æ’ä»¶è‡ªè¡Œä½¿ç”¨
  string title = 4;                   // æ ‡é¢˜
  string cover = 5;                   // å°é¢ éœ€è¦æä¾›æœ¬åœ°æ–‡ä»¶è·¯å¾„
  string work_dir = 6;                // å·¥ä½œç›®å½• (ğŸŒ)
  string filepath = 7;                // å·¥ä½œè·¯å¾„ (ğŸŒ)
  bool selected = 8;                  // æ˜¯å¦é€‰æ‹© (ğŸŒ)
  string magic_name = 9;              // é­”æ³•åç§° (ğŸŒ)
  int64 size = 10;                    // å¤§å° (btye) (ğŸŒ™ all â†“)
  int64 percent = 11;                 // å®Œæˆç™¾åˆ†æ¯” 
  int64 state = 12;                   // ä»»åŠ¡çŠ¶æ€ (1:ä¸‹è½½ä¸­ 2:é˜Ÿåˆ—ä¸­ 3:å·²å®Œæˆ)
  string status = 13;                 // ä»»åŠ¡çŠ¶å†µ (æ–‡æœ¬æè¿°)
  int64 speed = 14;                   // ä¸‹è½½é€Ÿåº¦(byte)
  int64 duration = 15;                // æŒç»­æ—¶é—´(ç§’)
  repeated Segment segments = 16;     // ç‰‡æ®µç»„
  repeated Progress progresses = 17;  // ä¸‹è½½è¿›åº¦
}

// èµ„æºç‰‡æ®µ
// å…·ä½“çš„æŸä¸€ä¸ªèµ„æº, æ¯”å¦‚è§†é¢‘/éŸ³é¢‘
// è¯¥èµ„æºå¯èƒ½æœ‰å¾ˆå¤šå¤‡é€‰é¡¹
message Segment {
  string mime_type = 1;        // ç±»å‹
  bool selected = 2;           // æ˜¯å¦é€‰æ‹©
  repeated Format formats = 3; // æ ¼å¼ç»„
}

// ä¸‹è½½è¿›åº¦
message Progress{
  int64 start =1;
  int64 end=2;
}

// èµ„æºå…·ä½“æ¡ç›®
message Format {
  int64 id = 1;         // æ ¼å¼ID
  string mime_type = 2; // ç±»å‹
  string label = 3;     // åª’ä½“æ ‡ç­¾ (e.g., "720p").
  string code = 4;      // (e.g., "mp4/mov","flac/mp3","png/jpg").
  string url = 5;       // URL for downloading this format.
  int64 size = 6;       // å¤§å° (btye)
  bool selected = 7;    // æ˜¯å¦é€‰æ‹© (ğŸŒ)
}
